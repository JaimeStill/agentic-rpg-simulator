{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "RPG Event State",
  "description": "State package structure for individual adventure events",
  "type": "object",
  "required": [
    "event_number",
    "world_state",
    "character_states",
    "action_log",
    "next_event_setup"
  ],
  "properties": {
    "event_number": {
      "type": "integer",
      "minimum": 0,
      "description": "The current event number in the sequence"
    },
    "world_state": {
      "type": "object",
      "required": ["location", "active_elements", "resources"],
      "properties": {
        "location": {
          "type": "string",
          "maxLength": 100,
          "description": "Compressed description of current location"
        },
        "active_elements": {
          "type": "array",
          "items": {
            "type": "string",
            "maxLength": 100
          },
          "description": "Key threats, opportunities, or environmental factors"
        },
        "resources": {
          "type": "array",
          "items": {
            "type": "string",
            "maxLength": 50
          },
          "description": "Available items, allies, or environmental resources"
        }
      },
      "additionalProperties": true
    },
    "character_states": {
      "type": "array",
      "minItems": 1,
      "maxItems": 6,
      "items": {
        "type": "object",
        "required": ["id", "name", "status", "evolution", "context"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^character-[a-z-]+$",
            "description": "Unique character identifier"
          },
          "name": {
            "type": "string",
            "minLength": 1,
            "maxLength": 50,
            "description": "Character's name"
          },
          "status": {
            "type": "string",
            "maxLength": 50,
            "description": "Health/resources status",
            "examples": [
              "Healthy",
              "Wounded",
              "Low magic",
              "Exhausted",
              "Empowered"
            ]
          },
          "evolution": {
            "type": "string",
            "maxLength": 200,
            "description": "Recent personality or skill changes"
          },
          "context": {
            "type": "string",
            "maxLength": 200,
            "description": "Relevant recent actions and relationships"
          },
          "equipment": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Current equipment or special items"
          },
          "relationships": {
            "type": "object",
            "additionalProperties": {
              "type": "string",
              "maxLength": 50
            },
            "description": "Relationships with other characters"
          }
        }
      }
    },
    "action_log": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["event", "summary", "consequences"],
        "properties": {
          "event": {
            "type": "integer",
            "description": "Event number this log entry refers to"
          },
          "summary": {
            "type": "string",
            "maxLength": 300,
            "description": "2-3 sentence outcome summary"
          },
          "consequences": {
            "type": "array",
            "items": {
              "type": "string",
              "maxLength": 100
            },
            "description": "Ongoing effects from this event"
          }
        }
      }
    },
    "next_event_setup": {
      "type": "object",
      "required": ["trigger", "stakes", "complexity"],
      "properties": {
        "trigger": {
          "type": "string",
          "maxLength": 150,
          "description": "What initiates the next event"
        },
        "stakes": {
          "type": "string",
          "maxLength": 150,
          "description": "What's at risk in the next event"
        },
        "complexity": {
          "type": "string",
          "enum": ["low", "medium", "high"],
          "description": "Expected complexity affecting token budget"
        },
        "focus_characters": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Characters who should be prominent in next event"
        },
        "expected_mechanics": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["combat", "social", "exploration", "puzzle", "survival"]
          },
          "description": "Likely mechanics needed for next event"
        }
      }
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "When this state was generated"
    },
    "token_usage": {
      "type": "object",
      "properties": {
        "total": {
          "type": "integer",
          "description": "Total tokens used in this event"
        },
        "breakdown": {
          "type": "object",
          "properties": {
            "setup": {
              "type": "integer"
            },
            "character_actions": {
              "type": "integer"
            },
            "mechanic_resolutions": {
              "type": "integer"
            },
            "state_update": {
              "type": "integer"
            }
          }
        }
      },
      "description": "Token usage statistics for this event"
    }
  }
}